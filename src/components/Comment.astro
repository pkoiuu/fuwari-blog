<div id="tcomment" class="twikoo-container"></div>

<script is:inline>
(function() {
  'use strict';
  
  // 配置
  var CONFIG = {
    envId: 'https://plbt.hhj520.top/',
    el: '#tcomment',
    lang: 'zh-CN',
    scriptUrl: 'https://cdn.jsdelivr.net/npm/twikoo@1.6.44/dist/twikoo.min.js'
  };
  
  // 标记是否已初始化
  var initialized = false;
  
  // 初始化 Twikoo
  function initTwikoo() {
    if (initialized) return;
    
    var container = document.getElementById('tcomment');
    if (!container) return;
    
    initialized = true;
    
    // 加载 Twikoo
    if (typeof twikoo === 'undefined') {
      var script = document.createElement('script');
      script.src = CONFIG.scriptUrl;
      script.async = true;
      script.onload = function() {
        runTwikoo();
      };
      script.onerror = function() {
        console.error('[Twikoo] Failed to load script');
      };
      document.head.appendChild(script);
    } else {
      runTwikoo();
    }
  }
  
  function runTwikoo() {
    try {
      twikoo.init({
        envId: CONFIG.envId,
        el: CONFIG.el,
        path: location.pathname,
        lang: CONFIG.lang,
        lazy: true,
        jumpToComment: false
      });
      console.log('[Twikoo] Initialized successfully');
    } catch (e) {
      console.error('[Twikoo] Init error:', e);
    }
  }
  
  // 使用 Intersection Observer 延迟加载
  if ('IntersectionObserver' in window) {
    var observer = new IntersectionObserver(function(entries) {
      entries.forEach(function(entry) {
        if (entry.isIntersecting) {
          initTwikoo();
          observer.disconnect();
        }
      });
    }, { rootMargin: '100px' });
    
    var container = document.getElementById('tcomment');
    if (container) {
      observer.observe(container);
    }
  } else {
    // 降级处理
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initTwikoo);
    } else {
      initTwikoo();
    }
  }
})();
</script>

<style scoped>
.twikoo-container {
  margin-top: 2rem;
  padding: 1.5rem;
  background-color: var(--card-bg);
  border-radius: var(--radius-large);
  border: 1px solid var(--line-divider);
  min-height: 100px;
}

:global(.twikoo),
:global(.tk-comments-container),
:global(.tk-expand),
:global(.tk-comment) {
  scroll-behavior: auto !important;
}

:global(.tk-main) {
  scroll-behavior: auto !important;
}

:global(.tk-submit) {
  scroll-behavior: auto !important;
}
</style>