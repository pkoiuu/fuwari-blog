# 修复构建错误：Cannot read properties of undefined (reading 'toISOString')

## 问题分析

通过分析构建日志和代码，我发现错误发生在以下环节：

1. **错误位置**：`formatDateToYYYYMMDD` 函数在 `src/utils/date-utils.ts` 文件中
2. **错误原因**：该函数直接调用 `date.toISOString()` 而没有检查 `date` 是否为 `undefined` 或 `null`
3. **触发场景**：构建 `spec/about/index.html` 时，`src/content/spec/about.md` 文件可能没有 `published` 字段
4. **根本原因**：
   - `spec` 集合的 schema 定义太宽松（空对象 `z.object({})`）
   - `PostMetadata` 组件的 `published` 属性被定义为必需的 `Date` 类型
   - `src/pages/spec/[...slug].astro` 在调用 `PostMetadata` 组件时没有检查 `entry.data.published` 是否存在

## 修复方案

### 1. 修改 `formatDateToYYYYMMDD` 函数

在 `src/utils/date-utils.ts` 文件中添加对 `undefined` 或 `null` 的处理：

```typescript
export function formatDateToYYYYMMDD(date: Date | undefined | null): string {
    if (!date) return "";
    return date.toISOString().substring(0, 10);
}
```

### 2. 修改 `src/pages/spec/[...slug].astro` 文件

确保在调用 `PostMetadata` 组件时传递有效的值：

```astro
<PostMetadata
        class="mb-5"
        published={entry.data.published || new Date()}
        updated={entry.data.updated}
        tags={entry.data.tags || []}
        category={entry.data.category || ""}
></PostMetadata>
```

### 3. 验证修复

运行 `npm run build` 命令验证修复是否成功，确保所有 `spec` 页面都能正常构建。

## 预期效果

修复后，构建过程应该能够正常完成，不会再出现 `Cannot read properties of undefined (reading 'toISOString')` 错误，所有 `spec` 目录中的内容都能通过 `/spec/[slug]/` 路径访问。