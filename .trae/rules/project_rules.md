# AI 文件操作规则

> 本规则适用于所有对 Fuwari 博客项目的代码操作  
> 版本: 1.0  
> 最后更新: 2026-02-05

---

## 📋 规则总则

### 1. 操作前必读

**在任何代码优化、错误修复或功能开发操作前，AI 必须：**

1. ✅ **查阅 PROJECT_STRUCTURE.md** - 理解项目整体结构
2. ✅ **识别关键文件位置** - 确认修改目标文件的正确路径
3. ✅ **了解模块划分** - 明确代码所属模块和职责
4. ✅ **检查依赖关系** - 确认修改不会影响其他模块

### 2. 操作后必做

**在完成所有修改操作后，AI 必须：**

1. ✅ **更新 PROJECT_STRUCTURE.md** - 同步文档与实际代码
2. ✅ **记录变更日志** - 在文档更新日志部分添加记录
3. ✅ **验证文档一致性** - 确保文档描述与代码一致

---

## 🔄 标准操作流程 (SOP)

### 阶段一：操作前准备

```
Step 1: 读取 PROJECT_STRUCTURE.md
        └─ 了解项目架构、技术栈、关键文件位置

Step 2: 分析用户需求
        └─ 确定涉及哪些模块和文件

Step 3: 定位目标文件
        └─ 根据文档中的目录树找到准确路径

Step 4: 检查依赖影响
        └─ 确认修改是否影响其他组件/功能
```

### 阶段二：执行操作

```
Step 5: 读取目标文件内容
        └─ 使用 Read 工具查看当前代码

Step 6: 制定修改方案
        └─ 规划具体的代码变更

Step 7: 执行修改
        └─ 使用 SearchReplace 或 Write 工具

Step 8: 验证修改
        └─ 检查语法正确性
```

### 阶段三：操作后维护

```
Step 9: 本地构建测试 (必须)
        └─ 运行: pnpm build && pnpm preview

Step 10: 更新 PROJECT_STRUCTURE.md
         └─ 如有以下变更需更新文档:
            • 新增/删除文件或目录
            • 修改关键配置
            • 变更组件状态(启用/禁用)
            • 更新依赖版本

Step 11: 记录更新日志
         └─ 在文档"更新日志"部分添加记录

Step 12: 最终验证
         └─ 确认文档与代码完全一致
```

---

## ✅ 操作前检查清单

### 必须确认的项目

| 检查项 | 要求 | 验证方式 |
|--------|------|----------|
| 项目结构文档 | 已阅读并理解 | 能说出关键目录作用 |
| 目标文件路径 | 确认准确无误 | 与文档目录树一致 |
| 技术栈版本 | 了解当前版本 | 查看 package.json |
| 部署配置 | 知晓关键配置 | 查看 edgeone.json |
| 禁用功能 | 知晓哪些功能已禁用 | 查看文档注意事项 |

### 关键文件速查

| 文件 | 路径 | 用途 |
|------|------|------|
| 项目结构说明 | `PROJECT_STRUCTURE.md` | 项目全貌文档 |
| 部署配置 | `edgeone.json` | EdgeOne 部署配置 |
| Astro 配置 | `astro.config.mjs` | 框架核心配置 |
| 站点配置 | `src/config.ts` | 博客站点设置 |
| 依赖管理 | `package.json` | 包和脚本 |
| 主题工具 | `src/utils/setting-utils.ts` | 主题相关函数 |

---

## 📝 操作后更新标准

### 需要更新文档的情况

#### 1. 文件结构变更
```markdown
✅ 新增文件/目录
   └─ 在目录树中添加对应条目
   └─ 在关键文件表格中添加说明

✅ 删除文件/目录
   └─ 从目录树中移除对应条目
   └─ 从关键文件表格中移除

✅ 移动文件
   └─ 更新目录树中的路径
   └─ 更新关键文件表格中的路径
```

#### 2. 配置变更
```markdown
✅ 修改 edgeone.json
   └─ 更新"关键文件详解"中的配置说明
   └─ 更新缓存策略表格

✅ 修改 astro.config.mjs
   └─ 更新集成列表
   └─ 更新优化配置说明

✅ 修改 package.json
   └─ 更新核心依赖版本
   └─ 更新脚本说明
```

#### 3. 功能状态变更
```markdown
✅ 启用/禁用功能
   └─ 更新"关键组件说明"表格中的状态列
   └─ 更新"已禁用功能"列表
   └─ 添加变更说明

✅ 修改 CDN/外部服务
   └─ 更新组件状态说明
   └─ 记录变更原因
```

#### 4. 依赖变更
```markdown
✅ 新增依赖
   └─ 在"核心依赖"表格中添加
   └─ 说明用途

✅ 删除依赖
   └─ 从"核心依赖"表格中移除

✅ 版本升级
   └─ 更新版本号
   └─ 记录升级原因(如有)
```

---

## 📊 文档更新格式

### 更新日志格式

```markdown
| 日期 | 变更内容 | 变更文件 | 操作人 |
|------|---------|---------|--------|
| YYYY-MM-DD | 简短描述 | 文件路径 | AI |
```

### 示例

```markdown
| 日期 | 变更内容 | 变更文件 | 操作人 |
|------|---------|---------|--------|
| 2026-02-05 | 强制禁用暗黑模式 | Layout.astro, Navbar.astro, setting-utils.ts | AI |
| 2026-02-05 | 更新 Twikoo CDN | Comment.astro | AI |
| 2026-02-05 | 优化 EdgeOne 缓存配置 | edgeone.json | AI |
```

---

## ⚠️ 特殊注意事项

### 禁止操作

| 禁止项 | 说明 | 后果 |
|--------|------|------|
| 未经测试直接提交 | 必须本地构建测试(测试需要明确告诉浏览器访问的完整 URL) | 可能导致线上故障 |
| 修改 edgeone.json 缓存 | 除非用户明确要求 | 影响 CDN 性能 |
| 恢复已禁用功能 | 如暗黑模式 | 违反用户要求 |
| 删除未记录的变更 | 所有变更需记录 | 文档不一致 |

### 必须执行

| 必须项 | 执行时机 | 验证方式 |
|--------|----------|----------|
| pnpm build | 每次修改后 | 无错误输出 |
| pnpm preview | 构建成功后 | 功能正常 |
| 更新文档 | 有结构/配置变更 | 文档与代码一致 |
| 记录日志 | 每次修改后 | 更新日志表格 |

---

## 🔍 常见操作参考

### 修改组件

```
1. 查阅文档 → 找到组件路径
2. 读取文件 → 了解当前实现
3. 执行修改 → 使用 SearchReplace
4. 构建测试 → pnpm build && pnpm preview
5. 更新文档 → 如有状态变更则更新
```

### 修改配置

```
1. 查阅文档 → 了解配置作用
2. 读取文件 → 查看当前配置
3. 执行修改 → 谨慎修改关键配置
4. 构建测试 → 确保配置有效
5. 更新文档 → 同步配置说明
```

### 添加功能

```
1. 查阅文档 → 了解项目架构
2. 规划位置 → 确定文件存放位置
3. 创建文件 → 编写新功能代码
4. 更新引用 → 在入口文件引入
5. 构建测试 → 验证功能正常
6. 更新文档 → 添加新文件到目录树
```

---

## 📚 快速参考

### 项目关键信息

| 属性 | 值 |
|------|-----|
| 项目名称 | Fuwari |
| 技术栈 | Astro + Svelte + Tailwind CSS |
| 部署平台 | 腾讯云 EdgeOne Pages |
| Node.js | >= 20 (部署使用 24.5.0) |
| 包管理器 | pnpm 9.14.4 |

### 常用命令

```bash
pnpm dev          # 开发服务器
pnpm build        # 构建 + 生成搜索索引
pnpm preview      # 预览构建结果
pnpm format       # 格式化代码
pnpm lint         # 代码检查
```

### 关键路径

```
项目根目录: d:\github-git\fuwari-blog
结构文档:   PROJECT_STRUCTURE.md
部署配置:   edgeone.json
站点配置:   src/config.ts
组件目录:   src/components/
页面目录:   src/pages/
```

---

## ✍️ 规则维护

- **规则版本**: 1.0
- **创建日期**: 2026-02-05
- **维护责任**: AI 助手
- **更新频率**: 随项目重大变更更新

---

*本规则旨在确保 AI 操作的一致性和项目文档的完整性。所有 AI 助手在处理本项目时必须严格遵守。*
